{% load tz %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warden Dashboard</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #eef2f7;
        }
        .dashboard-title {
            font-size: 1.8rem;
            font-weight: 700;
        }
        .card {
            border-radius: 14px;
        }
        .card-header {
            background-color: #ffffff;
            padding: 18px 24px;
        }
        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        .label {
            font-size: 1rem;
            color: #374151;
            font-weight: 600;
        }
        .value {
            font-size: 1.15rem;
            font-weight: 700;
            color: #111827;
        }
        .status-badge {
            font-size: 1rem;
            padding: 10px 18px;
            border-radius: 30px;
            font-weight: 700;
        }
        .btn {
            font-size: 1.05rem;
            padding: 10px 20px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    
    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-dark px-4 py-3">
        
<div class="login-box">

    <!-- Home Icon -->
    <a href="{% url 'home' %}" class="home-icon" title="Go to Home">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5V14a.5.5 0 0 0 .5.5H6a.5.5 0 0 0 .5-.5V10h3v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 .5-.5V7.5a.5.5 0 0 0-.146-.354l-6-6z"/>
        </svg>
    </a>
</div>
        <span class="navbar-brand dashboard-title">Warden Dashboard</span>
    </nav>
    
    <div class="container my-4">
        
        {% for gp in gatepasses %}
        <div class="card shadow mb-4">
            
            <!-- Header -->
            <div class="card-header d-flex justify-content-between align-items-center">
                <span class="fs-5 fw-bold">Gatepass Request</span>
                
                {% if gp.status == "pending" %}
                <span class="badge bg-warning text-dark status-badge">PENDING</span>
                {% elif gp.status == "approved" %}
                <span class="badge bg-success status-badge">APPROVED</span>
                {% elif gp.status == "rejected" %}
                <span class="badge bg-danger status-badge">REJECTED</span>
                {% elif gp.status == "returned" %}
                <span class="badge bg-info text-white status-badge">RETURNED</span>
                {% endif %}
            </div>
            
            <div class="card-body px-4 py-4">
                <div class="row g-5">
                    
                    <!-- Student Details -->
                    <div class="col-md-7">
                        <div class="section-title text-primary">Student Details</div>
                        
                        <div class="row g-4">
                            <div class="col-sm-6">
                                <div class="label">Name</div>
                                <div class="value">{{ gp.student.studentprofile.full_name }}</div>
                            </div>
                            
                            <div class="col-sm-6">
                                <div class="label">PRN</div>
                                <div class="value">{{ gp.student.studentprofile.prn }}</div>
                            </div>
                            
                            <div class="col-sm-6">
                                <div class="label">Mobile</div>
                                <div class="value">{{ gp.student.studentprofile.mobile }}</div>
                            </div>
                            
                            <div class="col-sm-6">
                                <div class="label">Department</div>
                                <div class="value">{{ gp.student.studentprofile.department }}</div>
                            </div>
                            
                            <div class="col-sm-6">
                                <div class="label">Year / Semester</div>
                                <div class="value">
                                    {{ gp.student.studentprofile.year }} /
                                    {{ gp.student.studentprofile.sem }}
                                </div>
                            </div>
                            
                            <div class="col-sm-6">
                                <div class="label">Hostel & Room</div>
                                <div class="value">
                                    {{ gp.student.studentprofile.hostel }} -
                                    {{ gp.student.studentprofile.room_no }}
                                </div>
                            </div>
                            
                            <div class="col-12">
                                <div class="label">Parent Details</div>
                                <div class="value">
                                    {{ gp.student.studentprofile.parent_name }} ({{ gp.student.studentprofile.parent_email }})
                                </div>
                            </div>
                            
                            <div class="col-12">
                                <div class="label">Address</div>
                                <div class="value">
                                    {{ gp.student.studentprofile.address }},
                                    {{ gp.student.studentprofile.city }},
                                    {{ gp.student.studentprofile.district }} -
                                    {{ gp.student.studentprofile.pincode }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gatepass Details -->
                    <div class="col-md-5">
                        <div class="section-title text-success">Gatepass Details</div>

                        <div class="mb-3">
                            <div class="label">Go to</div>
                            <div class="value">{{ gp.destination }}</div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="label">Reason</div>
                            <div class="value">{{ gp.reason }}</div>
                        </div>
                        
                        
                        <div class="mb-3">
                            <div class="label">Applied On</div>
                            <div class="value">
                                {{ gp.created_at|localtime|date:"d M Y, h:i A" }}
                            </div>
                        </div>
                        
                        
                        
                        
                        
                        {% if gp.approved_at %}
                        <div class="mb-3">
                            <div class="label">Approved On</div>
                            <div class="value">{{ gp.approved_at|date:"d M Y, h:i A" }}</div>
                        </div>
                        {% endif %}
                        
                        {% if gp.returned_at %}
                        <div class="mb-3">
                            <div class="label">Returned On</div>
                            <div class="value">{{ gp.returned_at|date:"d M Y, h:i A" }}</div>
                        </div>
                        {% endif %}
                        
                        <div class="mb-3">
                            <div class="label">GatePass ID</div>
                            <div class="value">{{ gp.gate_pass_id }}</div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="d-flex gap-3 mt-4 flex-column">
                            
                            {% if gp.status == "pending" %}
                            <form method="post" action="{% url 'approve_gatepass' gp.pk %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-success w-100">
                                    Approve
                                </button>
                            </form>
                            
                            <form method="post" action="{% url 'reject_gatepass' gp.pk %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger w-100">
                                    Reject
                                </button>
                            </form>
                            
                            {% elif gp.status == "approved" %}
                            <button class="btn btn-secondary w-100" disabled>Approved</button>
                            <button class="btn btn-secondary w-100" disabled>Reject</button>
                            
                            <form method="post" action="{% url 'close_gatepass' gp.pk %}">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-primary w-100">
                                    Close Entry (Student Returned)
                                </button>
                            </form>
                            
                            {% elif gp.status == "rejected" %}
                            <button class="btn btn-secondary w-100" disabled>Approve</button>
                            <button class="btn btn-danger w-100" disabled>Rejected</button>
                            
                            {% elif gp.status == "returned" %}
                            <button class="btn btn-secondary w-100" disabled>Approved</button>
                            <button class="btn btn-secondary w-100" disabled>Rejected</button>
                            <button class="btn btn-info w-100" disabled>Returned</button>
                            {% endif %}
                            
                        </div>
                        
                    </div>
                    
                </div>
            </div>
        </div>
        
        {% empty %}
        <div class="alert alert-info fs-5 text-center">
            No gatepass requests available.
        </div>
        {% endfor %}
        
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
